<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>

    <title>模联完善资料页面</title>
    <link rel="stylesheet" href="../css/mui.min.css"/>
    <link rel="stylesheet" href="../css/mui_popover.css"/>
    <link rel="stylesheet" href="../css/base.css"/>
    <link rel="stylesheet" href="../css/header.css"/>
    <link rel="stylesheet" href="../css/addData.css"/>
    <link rel="stylesheet" href="../css/sweetalert2.css"/>

</head>
<body>
<div class="layer">
    <header>
        <i onclick="back()"></i>
        <h3>完善资料</h3>
        <em onclick="location.href='login.html'" class="jump">跳过</em>
    </header>
    <div class="main_content">
       <div class="name clearfix">
           <span class="f_left">技工姓名：</span>
           <input type="text" placeholder="请输入姓名" />
       </div>
        <div class="type clearfix">
            <span class="f_left">技工工种：</span>
            <a href="#middlePopover" class="type_choose">+ 请选择工种名称</a>
            <div id="middlePopover" class="mui-popover">
                <div class="mui-card">
                    <p>请选择技术工种</p>
                    <ul class="mui-table-view mui-table-view-radio">
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                普通车床
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                数控车床
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                数控加工中心
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                刨床
                            </a>
                        </li>
                        <li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                线切割
                            </a>
                        </li><li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                钻床
                            </a>
                        </li><li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                钳工
                            </a>
                        </li><li class="mui-table-view-cell">
                            <a class="mui-navigate-right">
                                装配工
                            </a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
        <div class="work_year clearfix">
            <span class="f_left">工作年限：</span>
            <a href="#middlePopover1" class="work_choose">+ 请选择工作年限</a>
            <div id="middlePopover1" class="mui-popover">
                        <p>请选择工作年限</p>
                        <ul class="mui-table-view mui-table-view-radio word_year">
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right">
                                    0~1年
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right">
                                    1~3年
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right">
                                    3~5年
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right">
                                    5~10年
                                </a>
                            </li>
                            <li class="mui-table-view-cell">
                                <a class="mui-navigate-right">
                                    10年以上
                                </a>
                            </li>
                     </ul>

            </div>
        </div>
        <div class="ID_message clearfix">
            <span class="f_left">技工身份信息：</span>
            <input type="number" id="Idcard" placeholder="请填写技工身份证号码"/>
        </div>
        <div class="Id_photo clearfix">
            <span class="f_left">身份证信息：</span>
            <em>请上传您的身份证照片</em>
            <div class="against f_right">
                <div class="against_box">
                    <input type="file" id="against" accept="image/*" capture="camera" />
                </div>

                <em>身份证国徽面</em>
            </div>
            <div class="open f_right">
                <div class="open_box">
                    <input type="file" id="just" accept="image/*" capture="camera"/>
                </div>
            <em>身份证照片面</em>
            </div>

        </div>
        <div class="address clearfix">
            <span class="f_left">居住地址：</span>
            <input type="text" placeholder="请填写常用地址" />
        </div>
        <div class="phone clearfix">
            <span class="f_left">联系电话：</span>
            <input type="number"  placeholder="请输入电话号码" class="f_left phone_number"/>
            <input type="number" placeholder="请输入验证码" class="f_right ver_number"/>
           <em class="gain" onclick="getcode()">请输入验证码</em>
        </div>
        <div class="experience clearfix" onclick="location.href='./addData_work.html'">
            <span class="f_left">工作经历：</span>
            <em>+ 添加工作经历</em>
        </div>
        <div class="introduce clearfix">
            <span class="f_left">自我介绍：</span>
            <textarea placeholder="请输入自我介绍"></textarea>
        </div>
    </div>
    <div class="add_box">
        <button class="add_data">保存资料</button>
    </div>

</div>

</body>
<script src="../js/common/x_rem.js"></script>
<script src="../js/common/mui.min.js"></script>
<script src="../js/common/jquery.js"></script>
<script src="../js/common/base.js"></script>
<script src="../js/common/back.js"></script>
<script src="../js/common/sweetalert2.js"></script>
    <script>
        /*加个标记 判断是否隐藏 em*/
        var url=location.href.split("?")[1];
        console.log(url);
    if(url!==undefined){
        $(".jump").hide();
        }
        mui.init({
        swipeBack: true //启用右滑关闭功能
    });
    mui('.mui-scroll-wrapper').scroll();
    mui('body').on('shown', '.mui-popover', function(e) {
        window.event? window.event.cancelBubble = true : e.stopPropagation();
        //console.log('shown', e.detail.id);//detail为当前popover元素
    });
    mui('body').on('hidden', '.mui-popover', function(e) {
        window.event? window.event.cancelBubble = true : e.stopPropagation();
        //console.log('hidden', e.detail.id);//detail为当前popover元素
    });
    //采用自定义属性选择单选框吧
    //var info = document.getElementById("info");
    document.querySelector('.mui-table-view.mui-table-view-radio').addEventListener('selected',function(e){
        console.log("工作类型为：" + e.detail.el.innerText);
        document.querySelector(".type_choose").innerText=e.detail.el.innerText;
        document.querySelector(".type_choose").style.color="#333";
        document.querySelector("#middlePopover").style.display="none";
        document.querySelector(".mui-backdrop").style.display="none";
        window.event? window.event.cancelBubble = true : e.stopPropagation();
       /* alert(1);*/
    });
    document.querySelector('.mui-table-view.word_year').addEventListener('selected',function(e1){
        window.event? window.event.cancelBubble = true : e.stopPropagation();
        console.log("工作年限为：" + e1.detail.el.innerText);
        document.querySelector(".work_choose").innerText= e1.detail.el.innerText;
        document.querySelector(".work_choose").style.color="#333";
        document.querySelector("#middlePopover1").style.display="none";
        document.querySelector(".mui-backdrop").style.display="none";
       /* alert(1);*/
    });

    //验证身份证 电话不为空 11位的函数都在base.js里面了
  //图片预览 国徽面设置完毕  封装
    document.querySelector("#against").onchange=function () {
        var file=document.querySelector("#against").files;

        html5Reader(file,".against_box");
        //console.log(base64IdCardBack);
    }
    document.querySelector("#just").onchange=function () {
        var file=document.querySelector("#just").files;

        html5Reader(file,".open_box");
      // console.log(base64IdCardFront);
    }
    function html5Reader(file,ele){
        //var file = file.files[0];
        var reader = new FileReader();
       // reader.readAsDataURL(file);
        reader.readAsDataURL(file[0]);
        reader.onload = function(e){
            var pic = document.querySelector(ele);
            pic.style.backgroundImage="url("+reader.result+")";
           var des=reader.result;
           // console.log(des);
        }
    }
        $(".mui-navigate-right").click(function (event) {
                event.stopPropagation();

        })
        //点击保存资料的时候可以获取所有的信息
        $(".add_data").click(function () {
           var base64IdCardBack=$(".against_box").css('backgroundImage').replace('url(','').replace(')','');;
            console.log(base64IdCardBack);
            var base64IdCardFront=$(".open_box").css('backgroundImage').replace('url(','').replace(')','');;
            console.log(base64IdCardFront);
            //获取姓名
            let name=$(".name>input").val();
            console.log(name);
            let type_choose=$(".type_choose").text();
            console.log(type_choose);
            let work_choose=$(".work_choose").text();
            console.log(work_choose);
            //省份证
            let card=$("#Idcard").val();
            isCardNo(card);
            let adderess=$(".address>input").val();
            console.log(adderess);
            //
            let phone_number=$(".phone_number").val();
            let ver_number=$(".ver_number").val();
            if (!isNotBlank(ver_number)) {
                sweetAlert(
                        'sorry',
                        '短信验证码不能为空！',
                        'error'
                ).then(function () {
                            $(".phone_number").val("");
                        })
                return false;

            }
            //验证短信验证码是否正确；
            if(ver_number!==localStorage.getItem("code").replace(/\"/g,"")){
                sweetAlert(
                        'sorry',
                        '短信验证码不正确！',
                        'error'
                ).then(function () {
                            $("#phone_num").val("");
                        })
                return false;
            }
    let introduce=$(".introduce>textarea").val();
            console.log(introduce);

        })
        //倒计时效果
        $(".gain").click(function(){
            var time=60;
            $(this).text(time+ "S");
            var timer= setInterval(function(){
                time--;
                $(".gain").text(time+ "S");
                if(time<0){
                    clearInterval(timer);
                    $(".gain").text("重新发送");
                    time=60;
                }
            },1000)
        })
        //获取 短信验证码
        var flag = true;
        function getcode(){
            if(!flag){
                return;
            }
            var mobile = $('.phone_number').val();
            if(!checkTelNum(mobile)){
                sweetAlert(
                        'sorry',
                        '手机号码不正确！',
                        'error'
                ).then(function () {
                            $(".phone_number").val("");
                        })
                return false;
            }
            // var uuid=Math.random().toString(36).substr(2);
            //var obj = {mobile:mobile,uuid:uuid,type:1};
            flag = false;
            $.ajax({
                xhrFields: {
                    withCredentials: true
                },
                type: "post",
                url: baseUrl+"/api/getCode",
                data: {
                    mobilePhone:mobile
                },
                datType: 'json',
                success: function (data){
                    //alert(data);
                    console.log(data);
                    console.log(data.data.result);
                    window.localStorage.setItem("code",JSON.stringify(data.data.result));
                }
            })
        }
        //工作经验
        let companyName=localStorage.getItem("companyName");
        if(companyName){
            $(".experience>em").text("已添加完成");
            $(".experience>em").css("color","#333");
        }
</script>
</html>